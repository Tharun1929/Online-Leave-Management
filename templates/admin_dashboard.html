<!DOCTYPE html>
<html lang="en">
<head>
    <title>OLMS - Admin Dashboard</title>
    <link rel="icon" href="{{url_for('static', filename='email.png')}}" type="icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,shrink-to-fit=no">
    <meta name="description" content="Online Leave Management System - Admin Dashboard">
    <meta name="keywords" content="OLMS, Leave Management, Admin Dashboard">
    <meta name="author" content="Boddu Sri Pavan">
</head>
<body style="background-color: rgb(236, 255, 255);">
    {% include 'navigation_bar.html' %}

    {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert alert-success alert-dismissible" style="position:absolute; top:15%; width:20%; left:78%">
            <button type="button" class="btn-close shadow-none" data-bs-dismiss="alert"></button>
            <strong>{{ messages.0 }}</strong>
        </div>
        {% endif %}
    {% endwith %}

    <div class="container-fluid" style="padding-top: 8%; padding-bottom: 1%;">
        <div class="row">
            <div class="col-2"></div>
            <div class="col-5"><br><br>
                <h2 class="h1" style="color:rgb(0, 34, 49);">
                    Welcome {{ 'HoD' if faculty.0.5 == 'y' else 'Faculty' }}, {{ faculty.0.0 }}
                </h2>
            </div>
            <div class="col-5">
                <img src="{{ url_for('static', filename='university.png') }}" height="100%" width="30%">
            </div>
        </div><br><br>
    </div>

    <div class="container-fluid">
        <div class="row">
            <div class="col-2"></div>
            <div class="col-4"><h3 class="h3">Check Student's Leave History</h3></div>
            <div class="col-3">
                <form action="{{ url_for('student_history') }}" method="POST">
                    <input type="text" style="display:none" name="fac_id_num" value="{{ faculty.0.0 }}">
                    <center>
                        <textarea class="form-control" name="id_num" rows="1" style="width:70%; background-color:lightgoldenrodyellow" placeholder="Enter Student ID"></textarea>
                    </center>
            </div>
            <div class="col-1">
                <div class="form-group">
                    <center><button class="btn btn-warning" type="submit"><h5>Check</h5></button></center>
                </div>
                </form>
            </div>
            <div class="col-2"></div>
        </div>
    </div>

    {% if student_data %}
    <br><br><center><h1 class="h3 text-primary">{{ heading }}'s Leave History</h1></center><br>
    <div class="container">
        <table class="table table-striped bg-light">
            <tr>
                <th>Leave ID</th>
                <th>From Date</th>
                <th>To Date</th>
                <th>Reason</th>
                <th>Status</th>
            </tr>
            {% for row in student_data %}
            <tr>
                <td>{{ row.0 }}</td>
                <td>{{ row.2 }}</td>
                <td>{{ row.3 }}</td>
                <td>{{ row.4 }}</td>
                <td>
                    {% if row.5 == 'a' %}
                        <span class="text-success">Approved</span>
                    {% elif row.5 == 'b' %}
                        <span class="text-primary">Waiting for HoD</span>
                    {% elif row.5 == 'c' %}
                        <span class="text-info">Waiting for Faculty</span>
                    {% elif row.5 == 'r' %}
                        <span class="text-danger">Rejected</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    <br><br><h2 class="h2 text-primary text-center">Leave Applications</h2><br>
    <div class="container">
        <table class="table table-striped bg-light">
            <tr>
                <th>Leave ID</th>
                <th>Student ID</th>
                <th>From Date</th>
                <th>To Date</th>
                <th>Reason</th>
                <th>Action</th>
            </tr>
            {% for row in applications %}
            <tr>
                <td>{{ row.0 }}</td>
                <td>{{ row.1 }}</td>
                <td>{{ row.2 }}</td>
                <td>{{ row.3 }}</td>
                <td>{{ row.4 }}</td>
                <td>
                    <div class="row">
                        <div class="col">
                            <form action="{{ url_for('grant') }}" method="POST">
                                <input type="text" style="display:none" name="hod" value="{{ faculty.0.5 }}">
                                <input type="text" style="display:none" name="fac_id_num" value="{{ faculty.0.0 }}">
                                <input type="text" style="display:none" name="id_num" value="{{ row.0 }}">
                                {% if row.5 == 'c' and faculty.0.5 == 'n' %}
                                    <center>
                                        <textarea class="form-control" name="comment" rows="4" style="width:70%; background-color:lightgoldenrodyellow" placeholder="Comments"></textarea>
                                    </center>
                                    <input type="text" style="display:none" name="flag" value="passed to HoD">
                                    <button class="btn btn-success btn-xs" type="submit" style="width:100%">Pass to HoD</button>
                                {% elif row.5 == 'c' and faculty.0.5 == 'y' %}
                                    <center>
                                        <textarea class="form-control" name="comment" rows="4" style="width:70%; background-color:lightgoldenrodyellow" placeholder="Comments"></textarea>
                                    </center>
                                    <input type="text" style="display:none" name="flag" value="granted by HoD">
                                    <button class="btn btn-primary btn-xs" type="submit" style="width:100%">Grant</button>
                                {% elif row.5 == 'b' and faculty.0.5 == 'y' %}
                                    <center>
                                        <textarea class="form-control" name="comment" rows="4" style="width:70%; background-color:lightgoldenrodyellow" placeholder="Comments"></textarea>
                                    </center>
                                    <input type="text" style="display:none" name="flag" value="granted by HoD">
                                    <button class="btn btn-success btn-xs" type="submit" style="width:100%">Forwarded by Faculty</button>
                                {% endif %}
                            </form>
                        </div>
                        <div class="col">
                            <form action="{{ url_for('deny') }}" method="POST">
                                <input type="text" style="display:none" name="hod" value="{{ faculty.0.5 }}">
                                <input type="text" style="display:none" name="fac_id_num" value="{{ faculty.0.0 }}">
                                <input type="text" style="display:none" name="id_num" value="{{ row.0 }}">
                                <center>
                                    <textarea class="form-control" name="comment" rows="4" style="width:70%; background-color:lightgoldenrodyellow" placeholder="Comments"></textarea>
                                </center>
                                <input type="text" style="display:none" name="flag" value="{{ 'denied by HoD' if faculty.0.5 == 'y' else 'denied by faculty' }}">
                                <button class="btn btn-danger btn-xs" type="submit" style="width:100%">Deny</button>
                            </form>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <br><br>
</body>
</html>